class CustomLibCompletion{constructor(e,t,o){this.ace_editor=e,this.doc={},this.load_file(t),e.completers.push(this)}async load_file(e){try{var t=new Headers;t.append("pragma","no-cache"),t.append("cache-control","no-cache");let o=await fetch(e,{method:"GET",headers:t}),a=await o.json();Object.keys(a).forEach(e=>{this.doc[e]=a[e]}),console.log("Completion file is loaded !")}catch(e){console.error(e),new AlertDialog("Custom Completion error",`An error occured during loading completion file: <br/><div class="citation-error">${e.message}</div><br/>The user experience can be degraded. Try to restart your browser.`,AlertDialogIcon.ERROR).open()}}getCompletions(e,t,o,a,s){if(null==this.doc)return;var c=Object.keys(this.doc),n=this.getVarsAffectations(e.getValue());let r=t.getLine(o.row);if(r.slice(-2).includes(".")){let e=r.lastIndexOf("."),t=this.lastIndexOfRegex(r.slice(0,e),"[^a-zA-Z0-9_]"),o=r.slice(t+1,e);if(c.includes(o)){s(null,Object.keys(this.doc[o].classes).map(e=>({caption:e,value:e,meta:"from "+o,score:20,icon:"package"}))),s(null,this.doc[o].functions.map(e=>({caption:e.name,value:e.name,meta:"from "+o,score:20,icon:"method"}))),s(null,this.doc[o].others.map(e=>({caption:e,value:e,meta:"from "+o,score:20,icon:"property"})))}else if(Object.keys(n).includes(o)){let e=n[o][0],t=n[o][1];if(c.includes(e)){Object.keys(this.doc[e].classes).includes(t)&&s(null,this.doc[e].classes[t].map(e=>({caption:`${e.name}(${this.format_function_parameters(e.args,e.defaults)})`,value:e.name,meta:`${t}`,score:100,icon:"method"})))}}}else s(null,c.map(function(e){return{caption:e,value:e,meta:"module",icon:"package"}}))}getVarsAffectations(e){let t={};for(let o of e.matchAll(/^[\t ]*(?<var>\w+)[\t ]*=[\t ]*(?<content>\w[\w\.]*)[\w.\(\)]*$/gm))t[o.groups.var]=o.groups.content.split(".");return t}format_function_parameters(e,t){let o=e.slice();return t.forEach((e,t)=>{o[o.length-t]+=`=${e}`}),o.join(", ")}lastIndexOfRegex(e,t){let o,a=new RegExp(t,"g"),s=-1;for(;null!=(o=a.exec(e));)s=o.index;return s}}